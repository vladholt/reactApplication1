{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _tweenFunctions = require('tween-functions');\n\nvar _tweenFunctions2 = _interopRequireDefault(_tweenFunctions);\n\nvar _raf = require('raf');\n\nvar _raf2 = _interopRequireDefault(_raf);\n\nvar _EventDispatcher = require('./EventDispatcher');\n\nvar _EventDispatcher2 = _interopRequireDefault(_EventDispatcher);\n\nvar _util = require('./util');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n} // 设置默认数据\n\n\nfunction defaultData(vars) {\n  return {\n    ease: vars.ease || 'easeInOutQuad',\n    duration: vars.duration || 450,\n    docHeight: vars.docHeight,\n    scrollInterval: vars.scrollInterval || 1000,\n    loop: vars.loop || false,\n    location: vars.location || []\n  };\n}\n\nvar passive = (0, _util.getPassive)();\n\nvar ScrollScreenClass = function ScrollScreenClass() {\n  var _this = this;\n\n  (0, _classCallCheck3['default'])(this, ScrollScreenClass);\n\n  this.init = function (vars) {\n    _this.vars = defaultData(vars || {});\n    _this.rafID = -1;\n    _this.toHeight = -1;\n    _this.num = 0;\n\n    if (_util.windowIsUndefined) {\n      return;\n    }\n\n    _EventDispatcher2['default'].addEventListener('wheel.scrollWheel', _this.onWheel, null, passive); // dom 在 didMount 后高度没出来，加 setTimeout; \n\n\n    setTimeout(_this.startScroll);\n  };\n\n  this.unMount = function () {\n    _EventDispatcher2['default'].removeEventListener('wheel.scrollWheel', _this.onWheel);\n  };\n\n  this.setCurrentNNum = function () {\n    var mapped = _this.mapped;\n    var winHeight = (0, _util.windowHeight)();\n\n    if (!mapped.length) {\n      // 如果是空，采用一屏一滚;\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n      var scrollTopNum = _this.scrollTop / winHeight;\n      var docTopNum = docHeight / winHeight;\n      var docEndScreenHeight = docHeight % winHeight;\n      var currentOffset = _this.scrollTop % winHeight;\n      var currentTopScreen = Math.floor(scrollTopNum); // 判断最后一屏是否过中间 \n\n      var currentScreen = Math.ceil(scrollTopNum) === Math.floor(docTopNum) ? currentOffset / docEndScreenHeight : currentOffset / winHeight;\n      _this.num = Math.round(currentTopScreen + currentScreen);\n      _this.toHeight = _this.num * winHeight;\n    } else {\n      mapped.forEach(function (dom, i) {\n        var domOffsetTop = dom.offsetTop;\n        var domHeight = dom.getBoundingClientRect().height;\n\n        if (_this.scrollTop >= domOffsetTop && _this.scrollTop < domOffsetTop + domHeight) {\n          var exceed = (_this.scrollTop - dom.offsetTop) / domHeight; // 当前屏超过80%到下半屏, scrollOverPack 会动态改高度；\n\n          exceed = exceed > 0.8 ? 1 : 0;\n          _this.num = i + exceed;\n          _this.toHeight = domOffsetTop + exceed * domHeight;\n        }\n      });\n      var tooNum = void 0;\n      var endDom = mapped[mapped.length - 1];\n      var startDom = mapped[0];\n      var startManyHeight = startDom.offsetTop;\n\n      if (_this.scrollTop > endDom.offsetTop + endDom.getBoundingClientRect().height) {\n        tooNum = Math.ceil((_this.scrollTop - endDom.offsetTop - endDom.getBoundingClientRect().height) / winHeight);\n        _this.num = mapped.length + tooNum;\n        _this.toHeight = endDom.offsetTop + endDom.getBoundingClientRect().height + tooNum * winHeight;\n      } else if (_this.scrollTop < startManyHeight) {\n        var t = _this.scrollTop - startManyHeight;\n        tooNum = t > 0 ? Math.ceil(t / winHeight) : Math.floor(t / winHeight);\n        _this.num = tooNum;\n        var tc = Math.ceil(startManyHeight / winHeight);\n        _this.toHeight = (tc + tooNum) * winHeight;\n      }\n    }\n  };\n\n  this.startScroll = function () {\n    var mapped = _this.vars.location.map(function (str) {\n      return document.getElementById(str);\n    }).filter(function (c) {\n      return c;\n    });\n\n    _this.mapped = mapped;\n    _this.scrollTop = (0, _util.currentScrollTop)();\n    _this.animEndScrollTop = _this.scrollTop;\n\n    _this.setCurrentNNum();\n\n    if (mapped[0] && mapped[0].offsetTop >= (0, _util.windowHeight)()) {\n      console.warn('Warning: The first screen is not at the top, which may lead to poor scrolling effect, \"' + _this.vars.location[0] + '\" offsetTop ' + mapped[0].offsetTop + 'px.');\n    }\n\n    if (_this.toHeight !== _this.scrollTop) {\n      _this.initTime = Date.now();\n      _this.rafID = (0, _raf2['default'])(_this.raf);\n    } else {\n      _this.toHeight = -1;\n    }\n  };\n\n  this.raf = function () {\n    var duration = _this.vars.duration;\n    var now = Date.now();\n    var progressTime = now - _this.initTime > duration ? duration : now - _this.initTime;\n\n    var easeValue = _tweenFunctions2['default'][_this.vars.ease](progressTime, _this.scrollTop, _this.toHeight, duration);\n\n    _this.animEndScrollTop = easeValue;\n    window.scrollTo(window.scrollX, easeValue);\n\n    if (progressTime === duration) {\n      _this.cancelRequestAnimationFrame();\n\n      setTimeout(function () {\n        _this.toHeight = -1;\n      }, _this.vars.scrollInterval);\n    } else {\n      _this.rafID = (0, _raf2['default'])(_this.raf);\n    }\n  };\n\n  this.cancelRequestAnimationFrame = function () {\n    _raf2['default'].cancel(_this.rafID);\n\n    _this.rafID = -1;\n  };\n\n  this.getComputedStyle = function (dom) {\n    return dom && document.defaultView && document.defaultView.getComputedStyle ? document.defaultView.getComputedStyle(dom) : {};\n  };\n\n  this.isScroll = function (dom) {\n    var style = _this.getComputedStyle(dom);\n\n    var overflow = style.overflow;\n    var overflowY = style.overflowY;\n    var isScrollOverflow = overflow === 'auto' || overflow === 'scroll' || overflow === 'overlay' || overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay'; // dom.parentNode === document 解决在滚动条上滚动取不到 body;\n\n    if (dom === document.body || !dom || dom.parentNode === document) {\n      return false;\n    } else if (dom.scrollHeight > dom.offsetHeight && isScrollOverflow && dom.scrollTop < dom.scrollHeight) {\n      return true;\n    }\n\n    return _this.isScroll(dom.parentNode);\n  };\n\n  this.limitNum = function (min, max) {\n    if (_this.vars.loop) {\n      _this.num = _this.num < min ? max : _this.num;\n      _this.num = _this.num > max ? min : _this.num;\n    } else {\n      _this.num = _this.num < min ? min : _this.num;\n      _this.num = _this.num > max ? max : _this.num;\n    }\n  };\n\n  this.onWheel = function (e) {\n    e.preventDefault();\n\n    if (_this.isScroll(e.target)) {\n      return;\n    }\n\n    var deltaY = e.deltaY;\n    var mapped = _this.mapped;\n\n    if (_this.rafID === -1 && deltaY !== 0 && _this.toHeight === -1) {\n      var winHeight = (0, _util.windowHeight)();\n      _this.scrollTop = (0, _util.currentScrollTop)();\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n\n      if (_this.animEndScrollTop !== _this.scrollTop) {\n        _this.setCurrentNNum();\n      }\n\n      if (deltaY < 0) {\n        _this.num--;\n      } else if (deltaY > 0) {\n        _this.num++;\n      }\n\n      if (mapped.length) {\n        var endDom = mapped[mapped.length - 1];\n        var startDom = mapped[0];\n        var startManyHeight = startDom.offsetTop;\n        var startManyScale = startManyHeight ? Math.ceil(startManyHeight / winHeight) : 0;\n        var manyHeight = docHeight - endDom.offsetTop - endDom.getBoundingClientRect().height;\n        var manyScale = manyHeight ? Math.ceil(manyHeight / winHeight) : 0;\n\n        _this.limitNum(-startManyScale, mapped.length - 1 + manyScale);\n\n        var currentDom = mapped[_this.num];\n        _this.toHeight = currentDom ? currentDom.offsetTop : (startManyScale + _this.num) * winHeight;\n        _this.toHeight = _this.toHeight < 0 ? 0 : _this.toHeight;\n        _this.toHeight = _this.toHeight > docHeight - winHeight ? docHeight - winHeight : _this.toHeight;\n      } else {\n        _this.limitNum(0, Math.floor(docHeight / winHeight));\n\n        _this.toHeight = winHeight * _this.num;\n      }\n\n      _this.initTime = Date.now();\n      _this.rafID = (0, _raf2['default'])(_this.raf);\n    }\n  };\n};\n\nvar ScrollScreen = new ScrollScreenClass();\nexports['default'] = {\n  init: ScrollScreen.init,\n  unMount: ScrollScreen.unMount\n};\nmodule.exports = exports['default'];","map":{"version":3,"sources":["D:/Anastasiya/veb/test/my-app/node_modules/rc-scroll-anim/lib/ScrollScreen.js"],"names":["Object","defineProperty","exports","value","_classCallCheck2","require","_classCallCheck3","_interopRequireDefault","_tweenFunctions","_tweenFunctions2","_raf","_raf2","_EventDispatcher","_EventDispatcher2","_util","obj","__esModule","defaultData","vars","ease","duration","docHeight","scrollInterval","loop","location","passive","getPassive","ScrollScreenClass","_this","init","rafID","toHeight","num","windowIsUndefined","addEventListener","onWheel","setTimeout","startScroll","unMount","removeEventListener","setCurrentNNum","mapped","winHeight","windowHeight","length","document","body","scrollHeight","scrollTopNum","scrollTop","docTopNum","docEndScreenHeight","currentOffset","currentTopScreen","Math","floor","currentScreen","ceil","round","forEach","dom","i","domOffsetTop","offsetTop","domHeight","getBoundingClientRect","height","exceed","tooNum","endDom","startDom","startManyHeight","t","tc","map","str","getElementById","filter","c","currentScrollTop","animEndScrollTop","console","warn","initTime","Date","now","raf","progressTime","easeValue","window","scrollTo","scrollX","cancelRequestAnimationFrame","cancel","getComputedStyle","defaultView","isScroll","style","overflow","overflowY","isScrollOverflow","parentNode","offsetHeight","limitNum","min","max","e","preventDefault","target","deltaY","startManyScale","manyHeight","manyScale","currentDom","ScrollScreen","module"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _tweenFunctions = require('tween-functions');\n\nvar _tweenFunctions2 = _interopRequireDefault(_tweenFunctions);\n\nvar _raf = require('raf');\n\nvar _raf2 = _interopRequireDefault(_raf);\n\nvar _EventDispatcher = require('./EventDispatcher');\n\nvar _EventDispatcher2 = _interopRequireDefault(_EventDispatcher);\n\nvar _util = require('./util');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\n// 设置默认数据\nfunction defaultData(vars) {\n  return {\n    ease: vars.ease || 'easeInOutQuad',\n    duration: vars.duration || 450,\n    docHeight: vars.docHeight,\n    scrollInterval: vars.scrollInterval || 1000,\n    loop: vars.loop || false,\n    location: vars.location || []\n  };\n}\n\nvar passive = (0, _util.getPassive)();\n\nvar ScrollScreenClass = function ScrollScreenClass() {\n  var _this = this;\n\n  (0, _classCallCheck3['default'])(this, ScrollScreenClass);\n\n  this.init = function (vars) {\n    _this.vars = defaultData(vars || {});\n    _this.rafID = -1;\n    _this.toHeight = -1;\n    _this.num = 0;\n    if (_util.windowIsUndefined) {\n      return;\n    }\n    _EventDispatcher2['default'].addEventListener('wheel.scrollWheel', _this.onWheel, null, passive);\n    // dom 在 didMount 后高度没出来，加 setTimeout; \n    setTimeout(_this.startScroll);\n  };\n\n  this.unMount = function () {\n    _EventDispatcher2['default'].removeEventListener('wheel.scrollWheel', _this.onWheel);\n  };\n\n  this.setCurrentNNum = function () {\n    var mapped = _this.mapped;\n    var winHeight = (0, _util.windowHeight)();\n    if (!mapped.length) {\n      // 如果是空，采用一屏一滚;\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n      var scrollTopNum = _this.scrollTop / winHeight;\n      var docTopNum = docHeight / winHeight;\n      var docEndScreenHeight = docHeight % winHeight;\n      var currentOffset = _this.scrollTop % winHeight;\n      var currentTopScreen = Math.floor(scrollTopNum);\n      // 判断最后一屏是否过中间 \n      var currentScreen = Math.ceil(scrollTopNum) === Math.floor(docTopNum) ? currentOffset / docEndScreenHeight : currentOffset / winHeight;\n      _this.num = Math.round(currentTopScreen + currentScreen);\n      _this.toHeight = _this.num * winHeight;\n    } else {\n      mapped.forEach(function (dom, i) {\n        var domOffsetTop = dom.offsetTop;\n        var domHeight = dom.getBoundingClientRect().height;\n        if (_this.scrollTop >= domOffsetTop && _this.scrollTop < domOffsetTop + domHeight) {\n          var exceed = (_this.scrollTop - dom.offsetTop) / domHeight;\n          // 当前屏超过80%到下半屏, scrollOverPack 会动态改高度；\n          exceed = exceed > 0.8 ? 1 : 0;\n          _this.num = i + exceed;\n          _this.toHeight = domOffsetTop + exceed * domHeight;\n        }\n      });\n      var tooNum = void 0;\n      var endDom = mapped[mapped.length - 1];\n      var startDom = mapped[0];\n      var startManyHeight = startDom.offsetTop;\n\n      if (_this.scrollTop > endDom.offsetTop + endDom.getBoundingClientRect().height) {\n        tooNum = Math.ceil((_this.scrollTop - endDom.offsetTop - endDom.getBoundingClientRect().height) / winHeight);\n        _this.num = mapped.length + tooNum;\n        _this.toHeight = endDom.offsetTop + endDom.getBoundingClientRect().height + tooNum * winHeight;\n      } else if (_this.scrollTop < startManyHeight) {\n        var t = _this.scrollTop - startManyHeight;\n        tooNum = t > 0 ? Math.ceil(t / winHeight) : Math.floor(t / winHeight);\n        _this.num = tooNum;\n        var tc = Math.ceil(startManyHeight / winHeight);\n        _this.toHeight = (tc + tooNum) * winHeight;\n      }\n    }\n  };\n\n  this.startScroll = function () {\n    var mapped = _this.vars.location.map(function (str) {\n      return document.getElementById(str);\n    }).filter(function (c) {\n      return c;\n    });\n    _this.mapped = mapped;\n    _this.scrollTop = (0, _util.currentScrollTop)();\n    _this.animEndScrollTop = _this.scrollTop;\n    _this.setCurrentNNum();\n    if (mapped[0] && mapped[0].offsetTop >= (0, _util.windowHeight)()) {\n      console.warn('Warning: The first screen is not at the top, which may lead to poor scrolling effect, \"' + _this.vars.location[0] + '\" offsetTop ' + mapped[0].offsetTop + 'px.');\n    }\n    if (_this.toHeight !== _this.scrollTop) {\n      _this.initTime = Date.now();\n      _this.rafID = (0, _raf2['default'])(_this.raf);\n    } else {\n      _this.toHeight = -1;\n    }\n  };\n\n  this.raf = function () {\n    var duration = _this.vars.duration;\n    var now = Date.now();\n    var progressTime = now - _this.initTime > duration ? duration : now - _this.initTime;\n    var easeValue = _tweenFunctions2['default'][_this.vars.ease](progressTime, _this.scrollTop, _this.toHeight, duration);\n    _this.animEndScrollTop = easeValue;\n    window.scrollTo(window.scrollX, easeValue);\n    if (progressTime === duration) {\n      _this.cancelRequestAnimationFrame();\n      setTimeout(function () {\n        _this.toHeight = -1;\n      }, _this.vars.scrollInterval);\n    } else {\n      _this.rafID = (0, _raf2['default'])(_this.raf);\n    }\n  };\n\n  this.cancelRequestAnimationFrame = function () {\n    _raf2['default'].cancel(_this.rafID);\n    _this.rafID = -1;\n  };\n\n  this.getComputedStyle = function (dom) {\n    return dom && document.defaultView && document.defaultView.getComputedStyle ? document.defaultView.getComputedStyle(dom) : {};\n  };\n\n  this.isScroll = function (dom) {\n    var style = _this.getComputedStyle(dom);\n    var overflow = style.overflow;\n    var overflowY = style.overflowY;\n    var isScrollOverflow = overflow === 'auto' || overflow === 'scroll' || overflow === 'overlay' || overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay';\n    // dom.parentNode === document 解决在滚动条上滚动取不到 body;\n    if (dom === document.body || !dom || dom.parentNode === document) {\n      return false;\n    } else if (dom.scrollHeight > dom.offsetHeight && isScrollOverflow && dom.scrollTop < dom.scrollHeight) {\n      return true;\n    }\n    return _this.isScroll(dom.parentNode);\n  };\n\n  this.limitNum = function (min, max) {\n    if (_this.vars.loop) {\n      _this.num = _this.num < min ? max : _this.num;\n      _this.num = _this.num > max ? min : _this.num;\n    } else {\n      _this.num = _this.num < min ? min : _this.num;\n      _this.num = _this.num > max ? max : _this.num;\n    }\n  };\n\n  this.onWheel = function (e) {\n    e.preventDefault();\n    if (_this.isScroll(e.target)) {\n      return;\n    }\n    var deltaY = e.deltaY;\n    var mapped = _this.mapped;\n    if (_this.rafID === -1 && deltaY !== 0 && _this.toHeight === -1) {\n      var winHeight = (0, _util.windowHeight)();\n      _this.scrollTop = (0, _util.currentScrollTop)();\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n      if (_this.animEndScrollTop !== _this.scrollTop) {\n        _this.setCurrentNNum();\n      }\n      if (deltaY < 0) {\n        _this.num--;\n      } else if (deltaY > 0) {\n        _this.num++;\n      }\n      if (mapped.length) {\n        var endDom = mapped[mapped.length - 1];\n        var startDom = mapped[0];\n        var startManyHeight = startDom.offsetTop;\n        var startManyScale = startManyHeight ? Math.ceil(startManyHeight / winHeight) : 0;\n        var manyHeight = docHeight - endDom.offsetTop - endDom.getBoundingClientRect().height;\n        var manyScale = manyHeight ? Math.ceil(manyHeight / winHeight) : 0;\n        _this.limitNum(-startManyScale, mapped.length - 1 + manyScale);\n        var currentDom = mapped[_this.num];\n        _this.toHeight = currentDom ? currentDom.offsetTop : (startManyScale + _this.num) * winHeight;\n        _this.toHeight = _this.toHeight < 0 ? 0 : _this.toHeight;\n        _this.toHeight = _this.toHeight > docHeight - winHeight ? docHeight - winHeight : _this.toHeight;\n      } else {\n        _this.limitNum(0, Math.floor(docHeight / winHeight));\n        _this.toHeight = winHeight * _this.num;\n      }\n      _this.initTime = Date.now();\n      _this.rafID = (0, _raf2['default'])(_this.raf);\n    }\n  };\n};\n\nvar ScrollScreen = new ScrollScreenClass();\nexports['default'] = {\n  init: ScrollScreen.init,\n  unMount: ScrollScreen.unMount\n};\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}